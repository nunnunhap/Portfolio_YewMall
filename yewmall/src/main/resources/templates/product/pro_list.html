<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
				layout:decorate="~{layout/baselayout}">

<body>

<th:block layout:fragment = "content">
<div class="container">
  <div class="row">
    <div class="col-md-12 text-center">
      <h3 class="pb-4 mb-4" th:utext="${cate_name}"></h3>
    </div>
    <div class="col-md-4" th:each="product : ${pro_list}">
      <div class="card mb-4 shadow-sm">
        <a class="move" th:href="@{/product/pro_detail(pro_num = ${product.pro_num})}">
          <img th:src="${'/product/image_display?dateFolderName=' + product.pro_up_folder + '&fileName=s_' + product.pro_img}" style="width: 100%;height: 255px;">
        </a>
        <div class="card-body">
          <p class="card-text">
            <a th:href="@{/product/pro_detail(pro_num = ${product.pro_num})}"><span th:text="${product.pro_name}"></span></a><br>
            <span th:text="${#numbers.formatInteger(product.pro_price, 3, 'COMMA') + '원'}"></span>
          </p>
          <div class="d-flex justify-content-between align-items-center">
            <div class="btn-group">
              <button type="button" class="btn btn-sm btn-outline-secondary" name="btn_direct_order" th:data-pro_num="${product.pro_num}">BUY IT NOW</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" name="btn_cart_add" th:data-pro_num="${product.pro_num}">ADD TO CART</button>
            </div>
            <small class="text-muted">(review : 0)</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Paging 기능 -->
  <div class="row">
    <div class="col-md-4">
      <!-- Criteria 클래스 필드 사용 목적 -->
      <!-- 1) 페이지번호 클릭할 때 사용 2) 목록에서 상품이미지 또는 상품명 클릭할 때 사용   -->
      <form id="actionForm" action="" method="get">
        <input type="hidden" name="pageNum" id="pageNum" th:value="${pageMaker.cri.pageNum}">
        <input type="hidden" name="amount"  id="amount" th:value="${pageMaker.cri.amount}">
        
        <input type="hidden" name="cate_code" id="cate_code" th:value="${cate_code}">
        <input type="hidden" name="cate_name" id="cate_name" th:value="${cate_name}">
      </form>
    </div>
    <div class="col-md-6 text-center">
      <nav aria-label="...">
        <ul class="pagination">
          <!-- 이전 표시여부 -->
          <th:block th:if="${pageMaker.prev}">
            <li class="page-item">
              <a th:href="${pageMaker.startPage - 1}" class="page-link movepage">Previous</a>
            </li>
          </th:block>

          <!-- 페이지 번호 -->
          <th:block th:with="pageMaker = ${pageMaker}">
            <th:block th:each="num : *{#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
              <li class='page-item' th:classappend="${pageMaker.cri.pageNum ==  num ? 'active': ''}" aria-current="page">
                <a class="page-link movepage" th:href="${num}" th:text="${num}"></a>
              </li>
            </th:block>
          </th:block>

          <!--  다음 표시여부 -->
          <th:block th:if="${pageMaker.next}">
            <li class="page-item">
              <a th:href="${pageMaker.endPage + 1}" class="page-link movepage">Next</a>
            </li>
          </th:block>
        </ul>
      </nav>
    </div>
  </div>
</div>
</th:block>
<th:block layout:fragment = "script">
  <script>
    $(document).ready(function() {
      let actionForm = $("#actionForm");

      // 페이지 번호 클릭 시
      $(".movepage").on("click", function(e) {
        e.preventDefault();
        actionForm.attr("action", "/product/pro_list");
        actionForm.find("input[name='pageNum']").val($(this).attr("href"));

        actionForm.submit();
      });


    }); // ready event end
  </script>
</th:block>
    
</body>
</html>