<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yewmall.basic.review.ReviewMapper">

	<!-- 리뷰(상품구매후기) 목록 -->
	<select id="rev_list" resultType="ReviewVo" parameterType="map">
		SELECT
		    rev_code,
		    mbsp_id,
		    pro_num,
		    rev_title,
		    rev_content,
		    rev_rate,
		    rev_regdate
		FROM (
		    SELECT/*+ INDEX_DESC(review_tbl pk_review_code) */
		        ROWNUM AS rn,
		        rev_code,
		        mbsp_id,
		        pro_num,
		        rev_title,
		        rev_content,
		        rev_rate,
		        rev_regdate
		    FROM
		        review_tbl
		    WHERE
		        pro_num = #{pro_num}
		    AND
		    <![CDATA[
		        ROWNUM <= (#{cri.pageNum} * #{cri.amount})
		    )
		    ]]>
		    WHERE
		        rn > (#{cri.pageNum} - 1 ) * #{cri.amount}
	</select>
	
	<!-- 총 리뷰 갯수 -->
	<select id="getCountReviewByPro_num" resultType="int" parameterType="int">
		SELECT
			COUNT(*)
		FROM
			review_tbl
		WHERE
			pro_num = #{pro_num}
	</select>
	
	<!-- 리뷰 저장 -->
	<insert id="review_save" parameterType="ReviewVo">
		INSERT INTO review_tbl(
			rev_code,
		    mbsp_id,
		    pro_num,
		    rev_title,
		    rev_content,
		    rev_rate
		)
		VALUES(
			seq_rev_code.NEXTVAL,
			#{mbsp_id},
			#{pro_num},
			#{rev_title},
			#{rev_content},
			#{rev_rate}
			)
	</insert>
	
	<!-- 리뷰 삭제 -->
	<delete id="review_delete" parameterType="Long">
		DELETE FROM
			review_tbl
		WHERE
			rev_code = #{rev_code}
	</delete>
	
	<!-- 리뷰 수정 폼 -->
	<select id="review_modify" parameterType="Long" resultType="ReviewVo">
		SELECT
		    rev_code,
		    mbsp_id,
		    pro_num,
		    rev_title,
		    rev_content,
		    rev_rate,
		    rev_regdate
		FROM
		    review_tbl
		WHERE
			rev_code = #{rev_code}
	</select>
	
	<!-- 리뷰 수정 저장 -->
	<update id="review_update" parameterType="ReviewVo">
		UPDATE
			review_tbl
		SET
		    rev_title = #{rev_title},
		    rev_content = #{rev_content},
		    rev_rate = #{rev_rate},
		    rev_regdate = SYSDATE
		WHERE
			rev_code = #{rev_code}
	</update>
	

</mapper>